<div class="mis-compras">

  <!-- T√≠tulo distinto seg√∫n rol -->
  <h2 *ngIf="!esAdmin">Mis compras</h2>
  <h2 *ngIf="esAdmin">Todas las compras (ADMIN)</h2>

  <!-- Cargando -->
  <p *ngIf="loading">Cargando historial...</p>

  <!-- Error -->
  <p class="error" *ngIf="!loading && errorMsg">{{ errorMsg }}</p>

  <!-- No hay compras -->
  <p *ngIf="!loading && !errorMsg && compras.length === 0">
    No hay compras registradas.
  </p>

  <!-- Acorde√≥n -->
  <div class="accordion" *ngIf="!loading && !errorMsg && compras.length > 0">

    <!-- Cada compra -->
    <div class="accordion-item" *ngFor="let v of compras">

      <!-- Cabecera: SOLO ID -->
      <button
        type="button"
        class="accordion-header"
        (click)="toggleVenta(v._id)">

        <!-- ID de la venta -->
        <span class="venta-id">{{ v._id }}</span>

        <!-- Bot√≥n borrar SOLO ADMIN -->
        <button
          *ngIf="esAdmin"
          type="button"
          class="btn-borrar"
          (click)="$event.stopPropagation(); borrarVenta(v._id)">
          üóëÔ∏è
        </button>

        <!-- Flechita -->
        <span class="chevron" [class.open]="estaAbierta(v._id)">‚åÑ</span>
      </button>

      <!-- Contenido -->
      <div class="accordion-body" *ngIf="estaAbierta(v._id)">

        <div class="venta-resumen">
          <div><strong>Total:</strong> {{ v.total }} ‚Ç¨</div>
          <div><strong>Unidades:</strong> {{ unidades(v) }}</div>
          <div *ngIf="v.createdAt">
            <strong>Fecha:</strong> {{ v.createdAt | date:'short' }}
          </div>
          <div><strong>Estado:</strong> {{ v.estado || 'CONFIRMADA' }}</div>

          <!-- Si es admin, mostramos a qu√© usuario pertenece -->
          <div *ngIf="esAdmin">
            <strong>Usuario:</strong> {{ v.usuarioId || 'null' }}
          </div>
        </div>

        <ul class="lineas">
          <li *ngFor="let l of v.lineas">
            {{ l.titulo }} ‚Äî {{ l.cantidad }} x {{ l.precio }} ‚Ç¨
          </li>
        </ul>

      </div>

    </div>

  </div>
</div>
